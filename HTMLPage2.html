<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <script src="https://code.jquery.com/jquery-3.6.3.js"
            integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM="
            crossorigin="anonymous"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <title></title>
    <script>

        function OnCalculate() {
            var input = [];
            input.add({ ReferenceID: "abc", FundName: "aaa", Action: 1, Date: '12/12/2021', NumberOfUnits: 100.51, Amount: 50.33 });
            input.add({ ReferenceID: "abc", FundName: "aaa", Action: 2, Date: '12/12/2022', NumberOfUnits: 100.51, Amount: 55.33 });
            result = Calculate(input);
        }
        function Calculate(input) {
            ListofReferenceID = input.ReferenceID;
            var result = [];
            for (var i = 0; i < ListofReferenceID.legth; i++) {
                var strReferenceID = ListofReferenceID[i];
                lstPurchases = input;
                lstDispose = input;
                var output = { ReferenceID: strReferenceID };
                for (var j = 0; j < lstDispose.length; j++) {
                    var disposeTransaction = lstDispose[j];
                    var decDisposedUnits = lstDispose[j].NumberOfUnits;
                    var decRemainingDisposeUnits = lstDispose[j].NumberOfUnits;
                    var decTotalDisposeAmount = lstDispose[j].NumberOfUnits;
                    var perUnitDisposeAmount = decTotalDisposeAmount / decDisposedUnits;
                    for (var k = 0; k < lstPurchases.length; k++) {
                        var purchaseTransaction = lstPurchases[k];
                        var decRemainingPurchaseUnits = lstPurchases[k].NumberOfUnits == lstPurchases[k].AccountedFor;
                        if (decRemainingPurchaseUnits == 0) {
                            continue;
                        }
                        var objUnitBlock = {
                            PurchaseAmount: 1,
                            PurchaseDate: purchaseTransaction.Date,
                            DisposeDate: disposeTransaction.Date
                        };
                        if (decRemainingPurchaseUnits >= decRemainingDisposeUnits) {
                            objUnitBlock.Units = decRemainingDisposeUnits;
                            decRemainingDisposeUnits = 0;
                            lstPurchases[k].AccountedFor += decRemainingDisposeUnits;
                            break;
                        }
                        else {
                            objUnitBlock.Units = decRemainingDisposeUnits;
                            decRemainingDisposeUnits = decRemainingDisposeUnits;
                            decRemainingDisposeUnits -= decRemainingPurchaseUnits;
                            lstPurchases[k].AccountedFor = lstPurchases[k].NumberOfUnits;
                        }
                        objUnitBlock.PurchaseAmount = perUnitPurchaseAmount * objUnitBlock.Units;
                        objUnitBlock.DisposeAmount = perUnitDisposeAmount * objUnitBlock.Units;
                        output.UnitBlocks.Add(objUnitBlock);

                    }
                }
                result.add(output);
            }


            for (var i = 0; i < result.legth; i++) {
                var intMinYear = 2000;
                var intMaxYear = 2000;

                for (var j = 0; j < result[i].Block.length; j++) {
                    for (var k = result[i].Block[j].PurchaseDate.Year; k <= result[i].Block[j].DisposeDate.Year; k++) {
                        var objYear = { Year: k };
                        objYear.NumberOfDays = 1;
                        objYear.Line16c = 90;
                        result[i].Block[j].Years.Add(objYear);

                    }
                    result[i].Block[j].Line16B = 11;
                }
                result[i].TotalPurchase = 100;
                result[i].TotalDispose = 100;
                result[i].TotalLine16B = 100;
                for (var j = intMinYear; j <= intMaxYear; j++) {
                    var objYear = { Year: j };
                    objYear.TotalLine16C = 100;
                    objYear.NonResident = false;
                    result[i].Years.Add(objYear)
                }

                result[i].ExcessDistributionSummary.Life15f = 100;
                result[i].ExcessDistributionSummary.Life16b = 100;
                result[i].ExcessDistributionSummary.Life16c = 100;
                result[i].ExcessDistributionSummary.Life16d = 100;
                result[i].ExcessDistributionSummary.Life16e = 100;
                result[i].ExcessDistributionSummary.Life16f = 100;
            }
            return result;
        }
    </script>
</head>
<body>
    <table>
        <tr>
            <td>Tax Year:</td>
            <td>2022</td>
        </tr>
        <tr>
            <td>Fund Type:</td>
            <td>
                <select>
                    <option value="value">Section 1291</option>
                </select>
            </td>
        </tr>
    </table>
    <br /><br /><br />
    <table border="1" style="border-spacing: 0px;">
        <tr><td>S.No.</td><td>Reference ID Number</td><td>Fund Name</td><td>Action</td><td>Date</td><td># of Units</td><td>Amount</td></tr>
        <tr><td>1</td><td><input type="text"></td><td><input type="text"></td><td><select><option>Purchase</option><option>Disposition</option></select></td><td><input type="date"></td><td><input type="number" step=any></td><td><input type="number" step=any></td></tr>
        <tr><td>2</td><td><input type="text"></td><td><input type="text"></td><td><select><option>Purchase</option><option>Disposition</option></select></td><td><input type="date"></td><td><input type="number" step=any></td><td><input type="number" step=any></td></tr>
        <tr><td>3</td><td><input type="text"></td><td><input type="text"></td><td><select><option>Purchase</option><option>Disposition</option></select></td><td><input type="date"></td><td><input type="number" step=any></td><td><input type="number" step=any></td></tr>
        <tr><td>4</td><td><input type="text"></td><td><input type="text"></td><td><select><option>Purchase</option><option>Disposition</option></select></td><td><input type="date"></td><td><input type="number" step=any></td><td><input type="number" step=any></td></tr>
        <tr><td>5</td><td><input type="text"></td><td><input type="text"></td><td><select><option>Purchase</option><option>Disposition</option></select></td><td><input type="date"></td><td><input type="number" step=any></td><td><input type="number" step=any></td></tr>
        <tr><td>6</td><td><input type="text"></td><td><input type="text"></td><td><select><option>Purchase</option><option>Disposition</option></select></td><td><input type="date"></td><td><input type="number" step=any></td><td><input type="number" step=any></td></tr>
        <tr><td>7</td><td><input type="text"></td><td><input type="text"></td><td><select><option>Purchase</option><option>Disposition</option></select></td><td><input type="date"></td><td><input type="number" step=any></td><td><input type="number" step=any></td></tr>
        <tr><td>8</td><td><input type="text"></td><td><input type="text"></td><td><select><option>Purchase</option><option>Disposition</option></select></td><td><input type="date"></td><td><input type="number" step=any></td><td><input type="number" step=any></td></tr>
        <tr><td>9</td><td><input type="text"></td><td><input type="text"></td><td><select><option>Purchase</option><option>Disposition</option></select></td><td><input type="date"></td><td><input type="number" step=any></td><td><input type="number" step=any></td></tr>
    </table>
    <br /><br />
    <input type="button" value="Calculate" onclick="OnCalculate()" />
    <br /><br /><br />
    <hr />
    ABC<br />
    Reference ID Number: Fund1<br /><br />
    <table border="1" style="border-spacing: 0px;">
        <tr><td rowspan="2">Block#</td><td rowspan="2">Units</td><td colspan="2" style="text-align:center">Purchase</td><td colspan="2" style="text-align:center">Disposition</td><td colspan="4" style="text-align:center">Days</td><td rowspan="2">Line 16b</td><td colspan="3" style="text-align:center">Line 16c</td></tr>
        <tr><td>Date</td><td>Amount</td><td>Date</td><td>Amount</td><td>Year 2014 (Non-resident days)</td><td>Year 2015</td><td>Year 2016</td><td>2017</td><td>Year 2015</td><td>Year 2016</td><td>Year 2017</td></tr>
        <tr><td>1</td><td>2.00987</td><td>1/5/2020</td><td>$78.90</td><td>5/8/2017</td><td>$78.90</td><td>89</td><td>365</td><td>78</td><td>78</td><td>$78</td><td>$78</td><td>$78</td><td>$78</td></tr>
        <tr><td>2</td><td>2.00987</td><td>1/5/2020</td><td>$78.90</td><td>5/8/2017</td><td>$78.90</td><td>89</td><td>365</td><td>78</td><td>78</td><td>$78</td><td>$78</td><td>$78</td><td>$78</td></tr>
        <tr><td>3</td><td>2.00987</td><td>1/5/2020</td><td>$78.90</td><td>5/8/2017</td><td>$78.90</td><td>89</td><td>365</td><td>78</td><td>78</td><td>$78</td><td>$78</td><td>$78</td><td>$78</td></tr>
        <tr><td>4</td><td>2.00987</td><td>1/5/2020</td><td>$78.90</td><td>5/8/2017</td><td>$78.90</td><td>89</td><td>365</td><td>78</td><td>78</td><td>$78</td><td>$78</td><td>$78</td><td>$78</td></tr>
        <tr><td>5</td><td>2.00987</td><td>1/5/2020</td><td>$78.90</td><td>5/8/2017</td><td>$78.90</td><td>89</td><td>365</td><td>78</td><td>78</td><td>$78</td><td>$78</td><td>$78</td><td>$78</td></tr>
        <tr><td>6</td><td>2.00987</td><td>1/5/2020</td><td>$78.90</td><td>5/8/2017</td><td>$78.90</td><td>89</td><td>365</td><td>78</td><td>78</td><td>$78</td><td>$78</td><td>$78</td><td>$78</td></tr>
        <tr><td colspan="2">Total</td><td></td><td>$78.90</td><td></td><td>$78.90</td><td colspan="4"><td>$78</td><td>$78</td><td>$78</td><td>$78</td></tr>
    </table>
    <br /><br />
    Excess Distribution Summary
    <table border="1" style="border-spacing: 0px">
        <tr><td>Life 15f</td><td>Line 16b</td><td>Line 16c</td><td>Line 16d</td><td>Line 16e</td><td>Line 16f</td></tr>
        <tr><td>$40</td><td>$89</td><td>66</td><td>$0</td><td>$0</td><td>$0</td></tr>
    </table><br /><br />
    <hr />
    DEF<br />
    Reference ID Number: Fund2<br /><br />
    <table border="1" style="border-spacing: 0px;">
        <tr><td># of Shares</td><td>Purchase Date</td><td>Disposition Date</td><td>Profit</td><td>Total number of holding days</td><td>2020</td><td>2021</td><td>2022</td></tr>
        <tr><td>2.00987</td><td>1/5/2020</td><td>4/3/2022</td><td>$200.78</td><td>789</td><td>89</td><td>365</td><td>78</td></tr>
        <tr><td>2.00987</td><td>1/5/2020</td><td>4/3/2022</td><td>$200.78</td><td>789</td><td>89</td><td>365</td><td>78</td></tr>
        <tr><td>2.00987</td><td>1/5/2020</td><td>4/3/2022</td><td>$200.78</td><td>789</td><td>89</td><td>365</td><td>78</td></tr>
        <tr><td>2.00987</td><td>1/5/2020</td><td>4/3/2022</td><td>$200.78</td><td>789</td><td>89</td><td>365</td><td>78</td></tr>
        <tr><td>2.00987</td><td>1/5/2020</td><td>4/3/2022</td><td>$200.78</td><td>789</td><td>89</td><td>365</td><td>78</td></tr>
        <tr><td>2.00987</td><td>1/5/2020</td><td>4/3/2022</td><td>$200.78</td><td>789</td><td>89</td><td>365</td><td>78</td></tr>
    </table>
    <br /><br />
    Excess Distribution Summary
    <table border="1" style="border-spacing: 0px">
        <tr><td>Life 15f</td><td>Line 16b</td><td>Line 16c</td><td>Line 16d</td><td>Line 16e</td><td>Line 16f</td></tr>
        <tr><td>$40</td><td>$89</td><td>66</td><td>$0</td><td>$0</td><td>$0</td></tr>
    </table>
</body>
</html>